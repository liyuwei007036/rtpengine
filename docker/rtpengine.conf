# rtpengine Docker 容器配置文件
# 此配置针对容器化部署进行了优化

[rtpengine]

# 使用用户空间转发 (容器内无内核模块)
table = -1

# 接口配置引用 (前缀匹配，会匹配 [interface-*] 节)
interfaces-config = interface

# 信令模板配置引用
templates = templates

# 转码配置引用
transcode-config = transcode

# 控制协议监听器
# ng 协议 (基于 UDP 的 bencode) - 主控制接口
listen-ng = 0.0.0.0:22222

# TCP 控制协议 (取消注释以启用)
# listen-tcp = 25060

# UDP 控制协议 (取消注释以启用)
# listen-udp = 12222

# CLI 管理接口
listen-cli = 0.0.0.0:22223

# HTTP 接口，用于 REST API 和 Prometheus 指标
listen-http = 0.0.0.0:22225

# HTTPS 接口 (取消注释以启用)
# listen-https = 0.0.0.0:22226
# https-cert = /etc/rtpengine/cert.pem
# https-key = /etc/rtpengine/key.pem

# RTP 端口范围
# 注意: 使用 Docker 时，你需要:
# 1. 使用 host 网络模式 (--network host)
# 2. 或暴露整个端口范围 (-p 30000-40000:30000-40000/udp)
port-min = 30000
port-max = 40000

# 超时设置 (秒)
timeout = 60
silent-timeout = 3600
# delete-delay = 30
# final-timeout = 10800

# RTP 数据包的 TOS/DSCP 值
tos = 184
# control-tos = 184

# 前台运行 (Docker 必需)
foreground = true

# PID 文件路径 (需要 rtpengine 用户有写权限)
pidfile = /run/rtpengine/rtpengine.pid

# 日志输出到 stderr (用于 Docker 日志)
log-stderr = true

# 日志级别 (1-7, 数值越高越详细)
# 6 = INFO, 7 = DEBUG
log-level = 6
# log-facility = daemon
# log-facility-cdr = local0
# log-facility-rtcp = local1

# 线程配置
# num-threads = 16
# media-num-threads = 8
# http-threads = 4

# 录音配置
recording-dir = /var/spool/rtpengine
recording-method = proc
# recording-format = raw

# 最大会话数 (0 = 无限制)
# max-sessions = 5000

# 负载均衡阈值
# max-load = 5
# max-cpu = 90
# max-bandwidth = 10000000

# 调度配置
# scheduling = default
# priority = -3
# idle-scheduling = idle
# idle-priority = 10

# DTLS/SRTP 配置
# dtls-cert-cipher = prime256v1
# dtls-rsa-key-size = 2048
# dtls-mtu = 1200
# dtls-signature = sha-256
# dtls-ciphers = DEFAULT:!NULL:!aNULL:!SHA256:!SHA384:!aECDH:!AESGCM+AES256:!aPSK
# dtls-passive = false

# DTMF 配置
# dtmf-no-log-injects = 0

# DTX (不连续传输) 配置
# dtx-delay = 50
# max-dtx = 600
# dtx-buffer = 5
# dtx-lag = 100
# dtx-shift = 0
# amr-dtx = native
# dtx-cn-params = 60
# silence-detect = 0.05
# cn-payload = 60

# 音频播放器配置
# player-cache = false
# kernel-player = 0
# kernel-player-media = 128
# audio-buffer-length = 120
# audio-buffer-delay = 10
# audio-player = on-demand

# 音乐等待 (MoH) 配置
# moh-max-duration = 1800000
# moh-max-repeats = 999
# moh-attr-name = rtpengine-hold
# moh-prevent-double-hold = false

# 媒体文件预加载
# preload-media-files = /var/media/file1.wav ; /var/media/file2.wav
# media-files-reload = 60

# Redis 配置 (取消注释以启用)
# redis = redis:6379/0
# redis-write = redis:6379/0
# redis-subscribe = redis:6379/0
# redis-num-threads = 4
# no-redis-required = false
# redis-expires = 86400
# redis-allowed-errors = -1
# redis-disable-time = 10
# redis-cmd-timeout = 0
# redis-connect-timeout = 1000

# MQTT 配置 (取消注释以启用)
# mqtt-host = mqtt
# mqtt-port = 1883
# mqtt-tls-alpn = mqtt
# mqtt-id =
# mqtt-user =
# mqtt-pass =
# mqtt-publish-qos = 0
# mqtt-publish-topic = rtpengine
# mqtt-publish-interval = 5000
# mqtt-publish-scope = media

# Graphite 指标 (取消注释以启用)
# graphite = graphite:2003
# graphite-interval = 60
# graphite-prefix = rtpengine.

# Homer SIPCAPTURE (取消注释以启用)
# homer = homer:9060
# homer-protocol = udp
# homer-id = 2001

# MySQL 媒体播放配置 (取消注释以启用)
# mysql-host = mysql
# mysql-port = 3306
# mysql-user = rtpengine
# mysql-pass = rtpengine
# mysql-query = select data from voip.files where id = %llu

# B2B URL 配置
# b2b-url = http://127.0.0.1:8090/
# xmlrpc-format = 0

# Janus WebRTC 网关配置
# janus-secret = ABC123

# 其他选项
# endpoint-learning = heuristic
# reject-invalid-sdp = false
# sip-source = false
# mos = CQ
# poller-per-thread = false
# io-uring = false
# socket-cpu-affinity = -1
# rtcp-interval = 5000

# ============================================
# 转码配置示例
# ============================================
[transcode]
# 在此添加转码规则

[example-transcode-opus-to-pcma]
source = opus
destination = PCMA
# preference = 10

[example-transcode-pcma-to-opus]
source = PCMA
destination = opus
# preference = 10

# ============================================
# 信令模板
# ============================================
[templates]
WebRTC = transport-protocol=UDP/TLS/RTP/SAVPF ICE=force trickle-ICE rtcp-mux=[offer require] no-rtcp-attribute SDES=off generate-mid bundle=[require]

# ============================================
# 网络接口配置
# ============================================
[interface-default]
address = any
# name = default
# port-min = 30000
# port-max = 40000
# exclude-ports = 31111 ; 32222 ; 33333

# 多接口配置示例 (内部/外部网络)
# [interface-internal]
# address = 10.0.0.1
# name = internal

# [interface-external]
# address = 203.0.113.1
# name = external
